#!/usr/bin/env node
const fs = require('fs');
const path = require('path');

const DATE = new Date().toISOString().split('T')[0];
const ARTIFACT_DIR = path.join(__dirname, '..', 'artifacts', `PWA-AUDIT-${DATE}`);
const APP_URL = process.env.APP_URL || 'https://app.drouple.app';

function generateChecklist() {
  const checklist = `# PWA Native-Like Experience - Manual Checklist

**App URL:** ${APP_URL}  
**Test Date:** ${new Date().toLocaleDateString()}  
**Duration:** ~5 minutes

## Quick Manual Verification

### 1. Installation & Standalone Mode
- [ ] **Install Prompt**: Navigate to ${APP_URL} - install prompt appears (Chrome/Edge: install icon in address bar, Safari: Share > Add to Home Screen)
- [ ] **Standalone Launch**: After installation, launch app from home screen - opens without browser UI (no address bar, back button, etc.)

### 2. Deep Linking & Navigation
- [ ] **Deep Link**: Copy this URL ${APP_URL}/events and open in device browser - app opens to correct events page
- [ ] **Bottom Navigation**: Tap through navigation tabs - active states are visually distinct with proper highlights

### 3. Native-Like Interactions
- [ ] **Bottom Sheet**: Find and tap any button that opens a modal/sheet - animation is smooth (no jank or lag)
- [ ] **Pull-to-Refresh**: On main pages, pull down from top - refresh indicator appears with smooth animation
- [ ] **Swipe Actions**: Find list items - swipe left/right reveals action buttons (delete, edit, etc.)

### 4. Mobile UX Polish
- [ ] **Haptic Feedback**: Tap buttons and interact with forms - device vibrates appropriately (iOS: subtle taps, Android: varied patterns)
- [ ] **Touch Targets**: All buttons and links are easily tappable without precision (44x44px minimum)
- [ ] **Scrolling**: Page scrolling feels smooth and responsive without rubber-band effects or janky animations

### 5. Offline & Resilience
- [ ] **Offline Banner**: Turn off WiFi/cellular - app shows offline indicator but remains functional
- [ ] **Cached Content**: While offline, navigate between pages - previously visited pages load from cache
- [ ] **Retry Mechanism**: While offline, try to perform an action - app queues request and shows retry option

### 6. Visual Polish & Accessibility
- [ ] **Dark Mode**: Toggle device dark mode - app theme switches seamlessly with good contrast
- [ ] **Safe Areas**: On notched devices (iPhone X+), content properly avoids notch and bottom indicator
- [ ] **Loading States**: Navigate between pages - smooth loading animations without white flashes

## Notes Section
Write any issues or observations here:

\`\`\`
Navigation:
- 

Interactions:
- 

Performance:
- 

Visual:
- 
\`\`\`

## Scoring Guide
- **ðŸŸ¢ Excellent (9-10)**: Feels like a native app, no issues found
- **ðŸŸ¡ Good (7-8)**: Mostly native-like with 1-2 minor issues  
- **ðŸŸ  Needs Work (5-6)**: Several issues that break native illusion
- **ðŸ”´ Poor (1-4)**: Clearly a web app, many native features missing

**Overall Score: ___/10**

---
*Generated by PWA Audit Suite - ${new Date().toISOString()}*
`;

  return checklist;
}

if (require.main === module) {
  if (!fs.existsSync(ARTIFACT_DIR)) {
    fs.mkdirSync(ARTIFACT_DIR, { recursive: true });
  }
  
  const checklistPath = path.join(ARTIFACT_DIR, 'CHECKLIST.md');
  fs.writeFileSync(checklistPath, generateChecklist());
  console.log(`ðŸ“‹ Manual checklist generated at: ${checklistPath}`);
}

module.exports = generateChecklist;